    
{% extends "base/base.html" %}
{% load staticfiles %}
{% load crispy_forms_tags %}

{% block navTitle %}
{{actividad.accion.nombre}}
{% endblock %}


{% block extracss %}
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/5.0.1/css/fileinput.min.css" media="all" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="https://raw.githubusercontent.com/twbs/bootstrap-sass/master/assets/stylesheets/bootstrap/_glyphicons.scss">
<style>
    .btn-file{
        background-color: rgb(155, 16, 30) !important;
        border-color: rgb(155, 16, 30) !important;
    }
    button.btn-file:hover{
        background-color: rgb(176, 129, 134) !important;
        border-color: rgb(176, 129, 134) !important;
        color: white !important;
    }
    label{
        font-weight: bold;
    }
    .input-pago{
      min-width: 100px;
    }
    table.dataTable tbody tr{
        background: transparent !important;
    }
    #id_btn_segunda_parte{
      width: 100%;
      max-width:300px;
    }
    #filtros{
      position: fixed;
    }
</style>
{% endblock extracss %}

{%block messages %}
{%endblock%}


{% block content %}

    <div class="container bg-transparent">
        <div class="d-flex justify-content-end">
            <button id="filtros" class="btn guinda" data-toggle="tooltip" data-placement="top" title="Observaciones de la actividad">
                <i class="fas fa-comment"></i>
            </button>
        </div>
        {% if messages %}
        <ul class="messages">
            {% for message in messages %}
            <li{% if message.tags == "success" %} class="alert alert-success"
          {%else%}
          class="alert alert-danger"
          {% endif %}>
          {{ message }}</li>
            {% endfor %}
        </ul>
      {% endif %}
      
        <form id="id_form_actividad" action="" 
        method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <!-- <label for="id_tabla_presupuesto">Presupuesto ejercido*</label>
            <div class="table-responsive">
              <table class="table" id="id_tabla_presupuesto">
                <thead>
                  <tr>
                    <th scope="col">#</th>
                    <th scope="col">Concepto de gasto</th>
                    <th scope="col">Categor√≠a</th>
                    <th scope="col">Cantidad</th>
                  </tr>
                </thead>
                <tbody>
                </tbody>
              </table>
  
            </div> -->
            <hr>
            {{ form|crispy }}
            <label for="input-42-es">Evidencia*</label>
            <div class="file-loading">
                    <input required class="guinda" 
                    id="input-42-es" data-show-upload="false" 
                    name="archivos" type="file">
                </div> 
            <div id="id_gastos">
              
            </div>
            <div class="d-flex justify-content-center mt-5 min-w-100">
                    <button class="btn btn-primary guinda" id="id_btn_segunda_parte" 
                    type="submit">
                        Registrar &nbsp;<i class="fas fa-check"></i>
                    </button>
                    </div>
        </form>
      

    </div>

    
    

{% endblock content %}



{% block extrascripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/5.0.1/js/fileinput.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/5.0.1/js/plugins/piexif.min.js" type="text/javascript"></script>
<script src="{%static 'js/fa-theme.js'%}"></script>
<!-- sortable.min.js is only needed if you wish to sort / rearrange files in initial preview. 
    This must be loaded before fileinput.min.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/5.0.1/js/plugins/sortable.min.js" type="text/javascript"></script>
<!-- purify.min.js is only needed if you wish to purify HTML content in your preview for 
    HTML files. This must be loaded before fileinput.min.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/5.0.1/js/plugins/purify.min.js" type="text/javascript"></script>
<script src="{%static 'js/es.js'%}"></script>
<script>
    //esperaoms 1 segundo para que carguen todos los archivos
    setTimeout(() => {
        $("#input-42-es").fileinput({
            language:"es",
            theme: "fa",
            maxFileCount: 1,
            allowedFileExtensions: ["pdf"],
            maxFileSize: 10000
        });
        }, 1000);
 
    $(document).ready(()=>{
      $('[data-toggle="tooltip"]').tooltip();
      $('#filtros').click(()=>{
        console.log('hoooolaaa')
        Swal.fire({
          title: `<h4 class="modal-title">
              <strong>{{actividad.observaciones}}</strong>
            </h4>`,
          type:'warning',
          customClass:{
            confirmButton: 'guinda',
            cancelButton: 'guinda',
          }
        })
      });
      $('#id_personasInvolucradas').mask('00000000');
      $('#id_beneficiarios').mask('00000000');
      //*********************
      $( "#id_form_actividad" ).submit(function( event ) {
        event.preventDefault();
          let timerInterval
          Swal.fire({
            title: 'Subiendo',
            timer: 30000,
            onBeforeOpen: () => {
              Swal.showLoading()
            },
            onClose: () => {
              clearInterval(timerInterval)
            }
          }).then((result) => {
            if (
              // Read more about handling dismissals
              result.dismiss === Swal.DismissReason.timer
            ) {
              console.log('I was closed by the timer')
            }
          })
          string = $('#input-42-es')[0].files[0].name;
          string  = string.replace(/[^a-zA-Z0-9 ]/g, "")
          $('#input-42-es')[0].files[0].name = string  + '_evidencia.pdf'
          this.submit()

      });
    })
    </script>
{% endblock %}